<h1>Nuevo presupuesto</h1>
<div class="row">
  <div class="col-12">
    <form class="example-form" [formGroup]="presupuestoForm">
      <label for="">Datos del cliente:</label><br />
      
      <div class="row">
        <div class="col-12 col-md-12">
          <mat-form-field class="w-100 example-full-width" appearance="fill">
            <mat-label>Selecciona un cliente</mat-label>
            <input type="text"
                   placeholder="Escribe el nombre del cliente"
                   aria-label="Number"
                   matInput
                   formControlName="name"
                   [matAutocomplete]="auto">
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option *ngFor="let option of listOfClientsFiltered" [value]="option.name" (click)="setClient(option)">
                {{option.name}}
              </mat-option>
            </mat-autocomplete>
            <mat-error
              *ngIf="
                presupuestoForm.controls['name'].touched &&
                presupuestoForm.controls['name'].hasError('required')
              "
            >
              Este campo es obligatorio
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row">
        <div class="col-12 col-md-6">
          <mat-form-field class="w-100 example-full-width" appearance="fill">
            <mat-label>Dirección del cliente</mat-label>
            <input
              class="w-100"
              type="text"
              matInput
              formControlName="address"
              placeholder="dirección del cliente"
            />
            <mat-error
              *ngIf="
                presupuestoForm.controls['address'].touched &&
                presupuestoForm.controls['address'].hasError('required')
              "
            >
              Este campo es obligatorio
            </mat-error>
          </mat-form-field>
        </div>
        <div class="col-12 col-md-6">
          <mat-form-field class="w-100 example-full-width" appearance="fill">
            <mat-label>Correo Electrónico</mat-label>
            <input
              type="email"
              matInput
              formControlName="email"
              placeholder="correo electrónico"
            />
            <mat-error
              *ngIf="
                presupuestoForm.controls['email'].touched &&
                presupuestoForm.controls['email'].hasError('required')
              "
            >
              Este campo es obligatorio
            </mat-error>
            <mat-error
              *ngIf="
                presupuestoForm.controls['email'].touched &&
                presupuestoForm.controls['email'].hasError('email')
              "
            >
              Introduce un formato válido
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <label for="">Datos del Presupuesto:</label><br />
      <div class="row">
        <div class="col-12">
          <mat-form-field
            class="w-100 h-50 example-full-width"
            appearance="fill"
          >
            <mat-label>Asunto del presupuesto</mat-label>
            <input
              matInput
              #message
              maxlength="256"
              formControlName="Asunto"
              placeholder="Asunto del presupuesto"
            />
            <mat-hint align="start"
              ><strong>Escribe sobre que trata el presupuesto</strong>
            </mat-hint>
            <mat-hint align="end">{{ message.value.length }} / 256</mat-hint>
            <mat-error
              *ngIf="
                presupuestoForm.controls['Asunto'].touched &&
                presupuestoForm.controls['Asunto'].hasError('required')
              "
            >
              Este campo es obligatorio
            </mat-error>
            <mat-error
              *ngIf="
                presupuestoForm.controls['Asunto'].touched &&
                presupuestoForm.controls['Asunto'].hasError('maxLength')
              "
            >
              Solo puedes escribir 256 carácteres.
            </mat-error>
          </mat-form-field>
        </div>
      </div>
      <div class="row mt-2">
        <label>Agrega las Actividades</label>
        <div class="col-12 col-md-12">
          <mat-form-field class="w-100 example-full-width" appearance="fill">
            <mat-label>Descripción</mat-label>
            <input
              type="text"
              matInput
              placeholder="Descripción"
              [formControl]="descripcionControl"
            />
          </mat-form-field>
        </div>
        <div class="col-12 col-md-6">
          <mat-form-field class="w-100 example-full-width" appearance="fill">
            <mat-label>cantidad</mat-label>
            <input
              type="number"
              matInput
              placeholder="cantidad"
              [formControl]="cantidadControl"
            />
          </mat-form-field>
        </div>
        <div class="col-12 col-md-6">
          <mat-form-field class="w-100 example-full-width" appearance="fill">
            <mat-label>Precio unitario</mat-label>
            <input
              type="number"
              matInput
              placeholder="precio_unitario"
              [formControl]="precioUnitarioControl"
            />
          </mat-form-field>
        </div>
        <div class="col-12 col-md-12">
          <mat-form-field appearance="fill">
            <mat-label>Unidad</mat-label>
            <mat-select [formControl]="unidadControl">
              <mat-option
                *ngFor="let unidad of listOfUnidades"
                [value]="unidad.value"
              >
                {{ unidad.text }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>
      <button
        type="button"
        mat-raised-button
        color="primary"
        (click)="addActividad()"
      >
        {{ isEditActivity ? "Editar Actividad" : "agregar actividad" }}
      </button>
      <div
        class="actividades_list row"
        *ngFor="let item of arrayOfActividades; let i = index"
      >
        <div class="col-12">
          <label for="" class="text-center">{{ item.description }}</label>
        </div>
        <div class="col-4">
          <label for="">{{ item.cantidad }} {{ item.unidad }}</label>
        </div>
        <div class="col-4">
          <label for="">{{ item.precioUnitario | currency }}</label>
        </div>
        <div class="col-4">
          <button
            class="w-100"
            mat-raised-button
            color="primary"
            (click)="editActividad(item, i)"
          >
            Editar
          </button>
          <button
            class="mt-2 w-100"
            mat-raised-button
            color="warn"
            (click)="deleteActividad(i)"
          >
            Borrar
          </button>
        </div>
        <hr />
      </div>
      <hr />
      <div class="row mt-2">
        <div class="col-6">
          <button
            type="button"
            class="w-100"
            mat-raised-button
            color="primary"
            (click)="saveData()"
          >
            {{ data ? "EDITAR" : "CREAR" }}
          </button>
        </div>
        <div class="col-6">
          <button
            
            type="button"
            class="ms-2 w-100"
            mat-raised-button
            color="primary"
            (click)="closeModal()"
          >
            Cancelar
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
